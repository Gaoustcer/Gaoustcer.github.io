---
layout:     post
title:      计算机体系结构——指令集并行
subtitle:   计算机体系结构——指令集并行
date:       2021-05-27
author:     Haihan Gao
header-img: img/post-bg-swift2.jpg
catalog: true
tags:
    - Computer Architecture
    - Course review
---
# 计算机体系结构——指令集并行

## 静态指令集并行——编译时确定

* 循环展开
* 寄存器重命名减少数据相关

## 动态指令集并行

### 基本思想

* 当前指令被stall，允许这条指令之后的指令继续向前流动
* 顺序发射，乱序执行

### 记分牌技术

#### 技术要点与指令执行流程

* 增加了一个硬件部件称为记分牌，记录各个功能部件(流水段)的使用情况，对于每条指令判断能否执行
* 流水线部分，ID段拆分成两个阶段
  * issue，完成译码和检测结构相关
  * read operands读取操作数，需要在没有数据相关的时候读取操作数，需要和scoreboard比对，如果操作数准备好就可以读取，否则会stall当前指令

#### 记分牌的结构

> 为了检测结构相关，需要保存每个功能部件的状态，即是否空闲，如果不是空闲，需要保存源寄存器，目的寄存器，以及源寄存器是否准备好
>
> WAW相关需要记录每个寄存器当前是否被某条指令占用作为目的寄存器，保存写回数据产生的功能部件
>
> 指令乱序执行，需要记录每条指令的执行状态

##### Instruction status

表中第n行第j列表示第n条指令第j个流水段在什么周期执行

##### Function unit status

| Busy             | Op           | Fi             | Fj            | Fk            | Qj                  | Qk                  | Rj                | Rk                |
| ---------------- | ------------ | -------------- | ------------- | ------------- | ------------------- | ------------------- | ----------------- | ----------------- |
| 指示部件是否空闲 | 该部件的操作 | 目的寄存器编号 | 源寄存器1编号 | 源寄存器2编号 | 源操作数1的产生部件 | 源操作数2的产生部件 | 源操作数1是否就绪 | 源操作数2是否就绪 |

##### Register result status

指示哪一个功能部件对某个寄存器进行写操作，没有的话设置为blank

### 流水段工作概览

* issue段，指令译码，检测当前指令所需的功能部件(乘法器，浮点运算器)是否空闲，检测当前的指令的**目的寄存器**是否被其它指令作为目的寄存器占用(WAW相关)，若两者有一个不满足就停止发射当前指令
* Read operands段，通过scoreboard检测当前指令需要的源寄存器是否被其它已经发射的指令占用，如果没有，则需要读取相应的值作为操作数，否则该条指令stall，让后面指令先执行(RAW)
* Execution段，执行，执行前通知功能部件被占用，执行结束释放功能部件
* WB，向scoreboard发送一个执行结束的消息，检测指令的写回寄存器是否被作为源寄存器读取，检测WAR相关，如果存在WAR相关，就需要之前的指令先读取寄存器结束之后再写回