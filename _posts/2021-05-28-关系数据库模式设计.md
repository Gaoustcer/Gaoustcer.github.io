---
layout:     post
title:      数据库
subtitle:   关系数据库模式设计
date:       2021-05-28
author:     Haihan Gao
header-img: img/post-bg-swift2.jpg
catalog: true
tags:
    - Database
    - Course review
---
# 关系数据库模式设计

## 数据库模式

### 概念

* 数据库模式是数据库中全体数据的逻辑结构和特征的描述
* 数据库模式设计需要我们将现实师姐表达成数据库模式

### 关系数据库模式设计不规范会带来的问题(评价关系数据库模式的标准)

* 数据冗余
* 更新异常
* 插入异常
* 删除异常

### 解决异常和冗余的方法

模式分解

## 函数依赖(Functional Dependency FD)

### 定义

一个属性集和另一个属性集的多对一关系，给定属性集A的一个实例，必然而且只存在属性值B的一个实例与之对应，对于关系模式集合上的两个集合X，Y，若两个元组T1[X]=T2[X]，则必有T1[Y]=T2[Y]，称为Y函数依赖于X或者X函数决定Y，记作X->Y

### 关系模式的形式化定义

R(U,D,Dom,F) F为属性间的函数依赖关系集合 Dom是属性向域的映射集合，D是U中属性的值来自的域，U是属性集 **AC代表$A\bigcup B$**

### 平凡FD和不平凡FD

若$X\subset Y$称X->Y为平凡FD

### 函数依赖集的闭包

F为关系模式的一个函数依赖集，XY是R的属性自己，若从F的函数依赖中可以推出X->Y，则F逻辑蕴含X->Y，即为F|=X->Y

函数依赖集F蕴含的函数依赖的全体构成的集合称为F的闭包，记作$F^+$

### 码的形式化定义

关系模式R(U)，F是R的一个FD集，X是U的一个子集，若

* X->U$\in F^+$，则X是R的一个超码(关系模式中可以唯一标识一个元组的属性集称为关系模式的超码)
* 不存在X的真子集Y，使得Y->U成立，则X是R的一个候选码(不含多余属性的超码)

___

* 超码：关系模式中可以唯一标识一个元组的**属性集**
* 候选码：不包含多余属性的超码
  * 包含在某个候选码中的属性称为**主属性**
  * 不包含在**任何一个候选码**中的属性称为**非主属性**
* 主码，用户选作元组标识的一个候选码称为主码，其余的候选码称为替换码

### 属性集的闭包

* 我们的目的是给定一个哈市依赖集，判断函数依赖集X->Y是否可以从F中推出
* 属性集的闭包
  * 设F为属性集U上的一个FD集，X是U的子集，则称所有用Armstrong推理规则推出的函数依赖X->A中所有A的集合，称为属性集X关于F的闭包，称为$X^+$
* X->Y能由Armstrong推理规则推出的充要条件是$Y\subset X^+$

### 最小函数依赖集

##### 函数依赖集的等价与覆盖

* 设S1和S2是两个函数依赖集，若$S1^+\subset S2^+$则称S2是S1的覆盖
* 若S2,S1互相覆盖对方，称S1,S2等价

##### 定义

函数依赖集F满足如下条件时，F为最小函数依赖集

1. F的每个FD右边只有一个属性
2. F不可约，即F中的每个X->Y F-{X->Y}与F不等价
3. F的每个FD左边不可约，删除左边任何一个属性会使得F转变成一个不等价于原来的F的集合

## 模式分解

### 基本概念

将关系集合分解为多个子集，不要求是划分，包含两个方面

* 属性集的分解
* 函数依赖集的分解

### 模式分解的标准

* 具有无损连接
* 要保持函数依赖
* 既具有无损连接，又需要保持函数依赖

### 无损连接

#### 动机

模式分解应该是可逆的，R的所有数据在分解后应该没有丢失

#### 概念

R为关系模式，分解成关系模式$\omega=(R_1,R_2,...,R_k)$，若对R中满足F的每个关系r，都有r=$\pi_{R_1}(r)\times \pi_{R_2}(2)$，自然连接的结果和原先的表完全一致

### 保存函数依赖

* 关系模式R的FD集合在分解后仍然在数据库模式中保持不变
  * 给定R和R上的一个FD集F，$\rho$=(R1,R2,..,Rk)的分解应该使得F被Ri上的函数依赖逻辑蕴含
* 定义:F是属性集U上的函数依赖集，Z是U的子集，F在Z上的投影用$\pi_Z(F)$表示，定义为$\pi_Z(F)={X->Y|X->Y\in F^+ \land XY\subseteq Z}$，对于R(U)上的一个分解$\rho$，若满足下列条件，则称分解保持函数依赖集F
  *  $$(\bigcup_{i=1}^k \pi_{R_i}(F))^+=F^+$$

## 关系模式的范式

### 范式的概念

* 范式：满足特定要求的模式
  * 不同级别的范式要求各不相同
  * 范式可以作为衡量一个关系模式好坏的标准
  * 若关系模式R满足范式xNF，记作$R\in xNF$
* 规范化:将低级别范式的关系模式通过模式分解转换为高级范式的关系模式集合的过程

### 关系的函数依赖图

箭头表示字段之间有决定关系，每个候选码必定有箭头指出

### 1NF

元组的每个属性值只含有一个值

### 2NF

**R只有一个候选码/主码** 当且仅当R$\in$1NF，并且R的每一个非主属性**都完全依赖于**主码，则称$R\in 2NF$

* 完全函数依赖：对于函数依赖W->A，若不存在$X\subset W$并且使得X->A成立，则称W->A为完全函数依赖
* 主属性：包含在候选码中的属性
* 非主属性

### 3NF

**R只有一个候选码，且该候选码为主码** 当且仅当R属于2NF，且R的每一个非主属性都不传递依赖于主码时，R$\in$3NF

* 传递依赖：若Y->X，X->A并且X->Y不成立，A不是X的子集，则称A传递依赖于Y

### BCNF

* 主属性到码的函数依赖
* 主属性对非主属性的函数依赖
* 不允许主属性、非主属性到非码的FD

关系模式R所有不平凡的**完全的函数依赖**的决定因素(左边的属性集)都是候选码，则$R\in BCNF$